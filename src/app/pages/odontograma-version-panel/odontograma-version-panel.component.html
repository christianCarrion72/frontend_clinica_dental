<div class="mt-6 p-4 border rounded bg-white">
  <h3 class="font-semibold text-gray-800 mb-3">Versiones del odontograma</h3>

  <div class="flex gap-3 items-end mb-4">
    <div class="flex-1">
      <label class="block text-sm text-gray-600 mb-1">Nombre de versión</label>
      <input
        type="text"
        [(ngModel)]="nombreVersion"
        placeholder="Ej: Inicial, Control 3 meses"
        class="w-full border px-3 py-2 rounded"
      />
    </div>

    <button
      (click)="saveVersion()"
      [disabled]="saving || !odontogramaId || !json"
      class="px-4 py-2 rounded bg-blue-600 text-white disabled:opacity-50"
      title="Guardar versión del estado actual del odontograma"
    >
      Guardar versión
    </button>

    <button
      (click)="refresh()"
      [disabled]="loading"
      class="px-3 py-2 rounded bg-gray-200 text-gray-800"
      title="Actualizar historial"
    >
      Actualizar
    </button>
  </div>

  <div *ngIf="error" class="text-red-600 mb-2">{{ error }}</div>
  <div *ngIf="success" class="text-green-600 mb-2">{{ success }}</div>

  <div *ngIf="loading" class="text-gray-600">Cargando historial...</div>

  <div *ngIf="!loading && versions.length === 0" class="text-gray-600">
    Aún no hay versiones guardadas para este odontograma.
  </div>

  <ul *ngIf="!loading && versions.length > 0" class="space-y-2">
    <li *ngFor="let v of versions" class="border rounded p-3 flex justify-between items-center">
      <div>
        <div class="font-medium">{{ v.nombreVersion }}</div>
        <div class="text-sm text-gray-600">Creado: {{ v.created_at | date: 'short' }}</div>
      </div>
      <div class="flex gap-2">
        <button class="px-3 py-2 rounded bg-gray-100" (click)="selectVersion(v)">Ver</button>
      </div>
    </li>
  </ul>

  <div *ngIf="selectedVersion && selectedChart" class="mt-6">
    <div class="flex justify-between items-center mb-2">
      <div>
        <div class="font-semibold">Vista previa: {{ selectedVersion.nombreVersion }}</div>
        <div class="text-sm text-gray-600">{{ selectedVersion.created_at | date:'short' }}</div>
      </div>
      <button class="px-3 py-2 rounded bg-gray-100" (click)="closePreview()">Cerrar vista</button>
    </div>
    <app-teeth-chart
      [patientChart]="selectedChart"
      [scale]="0.30"
      [readonly]="true"
      [captureId]="'odontogramVersionCapture-' + selectedVersion.id">
    </app-teeth-chart>
  </div>
</div>
